<!-- ADICIONE ESSE SCRIPT EXTRA NO FINAL DO BODY -->
<script>
  // Coloque essa função no escopo global para que o botão funcione
  function playAudio() {
    const audio = document.getElementById("audio");
    audio.play().catch((error) => {
      alert("A reprodução da música foi bloqueada pelo navegador.");
    });
  }

  // Espera o Firebase carregar para chamar a função de mensagens
  window.addEventListener("DOMContentLoaded", () => {
    import("https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js").then(async firebaseModule => {
      const { initializeApp } = firebaseModule;
      const { getFirestore, collection, addDoc, getDocs, query, orderBy, deleteDoc, doc } =
        await import("https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js");

      const firebaseConfig = {
        apiKey: "AIzaSyBbEKyrUXiiRoDlHQlmrNbbqDEupsnG2lQ",
        authDomain: "new-project-8c27d.firebaseapp.com",
        projectId: "new-project-8c27d",
        storageBucket: "new-project-8c27d.appspot.com",
        messagingSenderId: "164821779712",
        appId: "1:164821779712:web:2e8e1a43c0774621071fe5"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.salvarMensagem = async function () {
        const nome = document.getElementById("nome").value.trim();
        const mensagem = document.getElementById("mensagem").value.trim();
        const palpite = document.querySelector('input[name="palpite"]:checked')?.value;

        if (nome && mensagem && palpite) {
          await addDoc(collection(db, "recados"), {
            nome,
            mensagem,
            palpite,
            data: new Date()
          });

          document.getElementById("nome").value = "";
          document.getElementById("mensagem").value = "";
          document.querySelectorAll('input[name="palpite"]').forEach(el => el.checked = false);

          carregarMensagens();
        } else {
          alert("Por favor, preencha todos os campos.");
        }
      }

      async function carregarMensagens() {
        const mensagensRef = collection(db, "recados");
        const q = query(mensagensRef, orderBy("data", "desc"));
        const querySnapshot = await getDocs(q);

        const lista = document.getElementById("listaMensagens");
        lista.innerHTML = "";

        querySnapshot.forEach((docSnapshot) => {
          const dados = docSnapshot.data();
          const item = document.createElement("p");
          item.textContent = `${dados.nome}: ${dados.mensagem} (Palpite: ${dados.palpite})`;

          const excluirButton = document.createElement("button");
          excluirButton.textContent = "Excluir";
          excluirButton.classList.add("excluir");
          excluirButton.onclick = async () => {
            await deleteDoc(doc(db, "recados", docSnapshot.id));
            carregarMensagens();
          };

          item.appendChild(excluirButton);
          lista.appendChild(item);
        });
      }

      // Carrega as mensagens ao abrir
      carregarMensagens();
    });
  });
</script>
